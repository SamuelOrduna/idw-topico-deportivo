{% extends "base.html" %}
{% block title %}Estadísticas | Arena Glory{% endblock %}
{% block tab_stats_active %}active{% endblock %}
{% block head_extra %}
<link href="/static/css/Estadisticas.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<main class="pb-5">
  <div class="container">
    <div class="row g-4">
      <!-- Columna izquierda (gráficas) -->
      <div class="col-12 col-lg-8">
        <div class="card-raised mb-4">
          <div class="card-header d-flex align-items-center justify-content-between">
            <h6 class="mb-0">ASISTENCIA POR EQUIPO</h6>
            <span class="chip"><i class="bi bi-lightning-charge-fill"></i> Fuente: API</span>
          </div>
          <div class="card-body">
            <canvas id="barGoles" height="140" aria-label="Gráfica de asistencia por equipo"></canvas>
            <div class="text-muted-2 small mt-2" id="attMeta"></div>
          </div>
        </div>

        <div class="card-raised">
          <div class="card-header"><h6 class="mb-0">Distribución por estado</h6></div>
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-12 col-md-6">
                <canvas id="pieCorners" height="180" aria-label="Gráfica de distribución por estado"></canvas>
              </div>
              <div class="col-12 col-md-6">
                <ul class="list-unstyled m-0" id="statusLegend"></ul>
                <div class="text-muted-2 small mt-3" id="statusMeta"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Columna derecha (CLASIFICACIÓN) -->
      <div class="col-12 col-lg-4">
        <div class="card-raised h-100">
          <div class="card-header"><h6 class="mb-0">CLASIFICACIÓN</h6></div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-sm align-middle mb-0">
                <thead class="text-secondary">
                  <tr>
                    <th style="width:3rem;">#</th>
                    <th>EQUIPO</th>
                    <th class="text-end">PTS</th>
                    <th class="text-end">PJ</th>
                    <th class="text-end">PG</th>
                    <th class="text-end">PE</th>
                  </tr>
                </thead>
                <tbody id="standingsBody"><!-- se llena por JS --></tbody>
              </table>
            </div>
            <div class="small text-secondary px-3 py-2 border-top" id="standingsMeta"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- KPIs -->
    <div class="mt-4">
      <div class="card-raised">
        <div class="card-header"><h6 class="mb-0">KPIs (demo)</h6></div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-6 col-md-3">
              <div class="p-3 border rounded-3 text-center" style="border-color:var(--card-border-2)!important;">
                <div class="text-muted-2 small">Equipos</div>
                <div id="kTeams" class="fs-4 fw-bold">-</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="p-3 border rounded-3 text-center" style="border-color:var(--card-border-2)!important;">
                <div class="text-muted-2 small">Eventos</div>
                <div id="kEvents" class="fs-4 fw-bold">-</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="p-3 border rounded-3 text-center" style="border-color:var(--card-border-2)!important;">
                <div class="text-muted-2 small">Asistencia total</div>
                <div id="kAtt" class="fs-4 fw-bold">-</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="p-3 border rounded-3 text-center" style="border-color:var(--card-border-2)!important;">
                <div class="text-muted-2 small">Actualizado</div>
                <div id="kUpd" class="fs-6 fw-semibold">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}

{% block scripts %}
  <!-- Chart.js debe cargarse en base.html antes de este script -->
  <script>
    // expone la URL de tu API al JS
    window.API_BASE = "{{ api_base or 'http://127.0.0.1:8000' }}";
  </script>
  <script src="/static/js/stats.js"></script>
{% endblock %}
